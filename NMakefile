# libsasl
# Copyright (C) 2010 Membase, Inc
# All rights reserved.
#
#   Licensed under the Apache License, Version 2.0 (the "License");
#   you may not use this file except in compliance with the License.
#   You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an "AS IS" BASIS,
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#   See the License for the specific language governing permissions and
#   limitations under the License.

TARGETOS=WINNT
!include <win32.mak>

INSTALL=c:\local
INSTALLDIRS=$(INSTALL) $(INSTALL)\include $(INSTALL)\include\sasl $(INSTALL)\lib $(INSTALL)\bin

libsasl.dll: client.obj
	$(link) $(dlllflags) -out:libsasl.dll -version:1.0 client.obj

client.obj: include/sasl/sasl.h \
            include/sasl/isasl.h \
            include/sasl/visibility.h \
            src/client.c
	$(cc) $(cdebug) $(cflags) $(cvarsdll) -Iinclude -DLIBISASL_INTERNAL src/client.c

install: $(INSTALLDIRS) libsasl.dll
	copy include\sasl\** $(INSTALL)\include\sasl
	copy libsasl.dll $(INSTALL)\lib
	copy libsasl.dll $(INSTALL)\bin
	copy libsasl.exp $(INSTALL)\lib
	copy libsasl.lib $(INSTALL)\lib

$(INSTALL) $(INSTALL)\include $(INSTALL)\include\sasl $(INSTALL)\lib $(INSTALL)\bin:; -@mkdir $@

clean:
	-del libsasl.* *.obj vc100.pdb
